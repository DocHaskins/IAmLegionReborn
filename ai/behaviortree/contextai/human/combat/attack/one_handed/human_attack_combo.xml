<?xml version="1.0"?>
<BehaviorTree xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../../../MetaData/schema_ai.xsd" m_ContextType="ai">
    <SequenceMem>
        <Cnd_IsTargetInAir m_Target="#target" m_Invert="true"/>
        <Cnd_IsCombatTargetInRange m_Radius="$attack_combo_max_range" m_Angle="$attack_combo_max_angle"/>
        <Cnd_IsCombatTargetMeleeReachable/>
        <Cnd_AllyInLineOfFire m_Target="#target" m_CheckMelee="true" m_SpaceNeeded="$attack_min_space" m_Invert="true"/>
        <!-- <Opr_RandomInt m_Result="#combo_id" m_RangeMin="0"  m_RangeMax="1"/> -->
        <!-- #TODO_AI use QA QA PA combo only for now -->
        <Opr_SetBBValue_int m_Key="#combo_id" m_Value="0"/>
        <Opr_SetBBValue_int m_Key="#attack_phase" m_Value="0"/>
        <Opr_Trigger m_Key="#trigger_combo"/>
        <Succeeder>
            <RepeatOnceOnSuccess>
                <Starter m_Key="#trigger_combo">
                    <Parallel m_PolicySuccess="REQUIRE_ONE" m_PolicyFailure="REQUIRE_ONE">
                        <SequenceMem>
                            <Opr_SetDirCorrectionSpeed m_MaxSpeed="$attack_combo_dir_correction_speed"/>
                            <Opr_SetPosCorrectionSpeed m_MaxSpeed="$attack_pos_correction_speed"/>
                            <!-- #TODO Fix joining combo attack on interrupt (CanJoinTask) - change start policy to INTERRUPT -->
                            <SetFlagOnRunning m_Key="#can_attack_recoil">
                                <Act_Attack m_Target="#target" m_AttackPresetName="human_1h_combo" m_ComboId="#combo_id" m_Phase="#attack_phase" m_EnablePosCorrection="$enable_attack_pos_correction" m_StartPolicy="DISCARD" m_AbandonPolicy="BLENDOUT" m_DecisionPolicy="ON_END"/>
                            </SetFlagOnRunning>
                        </SequenceMem>
                        <RunUntilSuccess>
                            <Sequence>
                                <Cnd_CanAttackCombo/>
                                <Cnd_IsCombatTargetInRange m_Radius="$attack_combo_max_range" m_Angle="$attack_combo_max_angle"/>
                                <Opr_IncrementBBValue_int m_Key="#attack_phase" m_Amount="1"/>
                                <Opr_Trigger m_Key="#trigger_combo"/>
                            </Sequence>
                        </RunUntilSuccess>
                    </Parallel>
                </Starter>
            </RepeatOnceOnSuccess>
        </Succeeder>
    </SequenceMem>
</BehaviorTree>
