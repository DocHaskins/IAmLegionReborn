<?xml version="1.0"?>
<BehaviorTree xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../../MetaData/schema_ai.xsd" m_ContextType="ai">
    <CooldownUntil m_TimePoint="#attack_cooldown" m_CooldownTime="$attack_cooldown" m_CooldownOnAbort="true">
        <SelectorMem>
            <Optional m_Enabled="$enable_attack_grab" m_CustomName="GrabAttempt" m_Hide="true">
                <CooldownTimeDelta m_CooldownTime="$attack_grab_cooldown" m_CooldownOnAbort="true">
                    <SequenceMem>
                        <Cnd_IsCombatTargetMeleeReachable/>
                        <Cnd_TargetIsBlocking m_Target="#target" m_MinTime="0.1"/>
                        <Cnd_AllyInLineOfFire m_Target="#target" m_CheckMelee="true" m_Invert="true"/>
                        <Cnd_IsCombatTargetInRange m_Radius="$attack_grab_max_range" m_Angle="$attack_grab_max_angle"/>
                        <CombatSlot m_Name="$attack_grab_token" m_Limit="$attack_grab_limit" m_MinDelay="$attack_grab_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="false">
                            <ExternalTree m_UID="HUMAN_ATTACK_GRAB_ATTEMPT" m_CustomName="Grab" m_Hide="true"/>
                        </CombatSlot>
                    </SequenceMem>
                </CooldownTimeDelta>
            </Optional>
            <BlackboardSwitch m_Enabled="#enable_attack_push" m_CustomName="AttackPush" m_Hide="true">
                <CooldownUntil m_CooldownTime="$attack_push_cooldown" m_TimePoint="#push_cooldown" m_CooldownOnAbort="true">
                    <SequenceMem>
                        <Cnd_IsCombatTargetMeleeReachable/>
                        <Cnd_IsActivityModuleRunning_Movement m_Invert="true"/>
                        <Cnd_TargetIsBlocking m_Target="#target" m_Invert="true"/>
                        <Cnd_IsTargetAttacking m_Target="#target" m_Invert="true"/>
                        <Cnd_IsCombatTargetInRange m_Radius="3" m_Angle="$attack_push_max_angle"/>
                        <Cnd_IsOtherGroupMemberCloserToPosition m_Position="#target_pos" m_Invert="true"/>
                        <Cnd_IsTargetInAir m_Target="#target" m_Invert="true"/>
                        <CombatSlot m_Name="$attack_push_token" m_Limit="$attack_push_limit" m_MinDelay="$attack_push_min_delay" m_Cost="#attack_cost" m_CheckIfUsing="true">
                            <SequenceMem>
                                <ExternalTree m_UID="HUMAN_ATTACK_PUSH" m_CustomName="Push" m_Hide="true"/>
                                <Succeeder>
                                    <BlackboardSwitch m_Enabled="#enable_attack_push_followup">
                                        <ExternalTree m_UID="HUMAN_ATTACK_QUICK" m_CustomName="Quick" m_Hide="true"/>
                                    </BlackboardSwitch>
                                </Succeeder>
                            </SequenceMem>
                        </CombatSlot>
                    </SequenceMem>
                </CooldownUntil>
            </BlackboardSwitch>
            <BlackboardSwitch m_Enabled="#enable_attack_combo">
                <SequenceMem>
                    <Selector>
                        <Cnd_IsCombatTargetInRadius m_Radius="$attack_attempt_range"/>
                        <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="aggressive"/>
                    </Selector>
                    <CombatSlot m_Name="$attack_combo_token" m_Limit="$attack_combo_limit" m_MinDelay="$attack_combo_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="#attack_token_release_on_damage" m_CheckIfUsing="true">
                        <Selector>
                            <ExternalTree m_UID="HUMAN_ATTACK_COMBO" m_CustomName="Combo" m_Hide="true"/>
                            <ExternalTree m_UID="HUMAN_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                        </Selector>
                    </CombatSlot>
                </SequenceMem>
            </BlackboardSwitch>
            <BlackboardSwitch m_Enabled="#enable_attack_power">
                <CooldownTimeDelta m_CooldownTime="$attack_power_cooldown" m_CooldownOnAbort="true">
                    <SequenceMem>
                        <Cnd_IsTargetChargingAttack m_Target="#target" m_Invert="true"/>
                        <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="rush" m_Invert="true"/>
                        <Selector>
                            <Cnd_IsCombatTargetInRadius m_Radius="$attack_attempt_range"/>
                            <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="aggressive"/>
                        </Selector>
                        <CombatSlot m_Name="$attack_power_token" m_Limit="$attack_power_limit" m_MinDelay="$attack_power_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="#attack_token_release_on_damage" m_ReleaseAfterAttackTime="$attack_power_release_after_time" m_CheckIfUsing="true">
                            <Selector>
                                <ExternalTree m_UID="HUMAN_ATTACK_POWER" m_CustomName="Power" m_Hide="true"/>
                                <ExternalTree m_UID="HUMAN_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                            </Selector>
                        </CombatSlot>
                    </SequenceMem>
                </CooldownTimeDelta>
            </BlackboardSwitch>
            <BlackboardSwitch m_Enabled="#enable_attack_quick">
                <SequenceMem>
                    <Selector>
                        <Cnd_IsCombatTargetInRadius m_Radius="$attack_attempt_range"/>
                        <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="aggressive"/>
                    </Selector>
                    <CombatSlot m_Name="$attack_quick_token" m_Limit="$attack_quick_limit" m_MinDelay="#attack_quick_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="#attack_token_release_on_damage" m_ReleaseAfterAttackTime="$attack_quick_relase_after_rime" m_CheckIfUsing="true">
                        <Selector>
                            <ExternalTree m_UID="HUMAN_ATTACK_QUICK_STEP" m_CustomName="QuickStep" m_Hide="true"/>
                            <ExternalTree m_UID="HUMAN_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                        </Selector>
                    </CombatSlot>
                </SequenceMem>
            </BlackboardSwitch>
            <Optional m_Enabled="$enable_attack_quick_reaction" m_CustomName="Attack" m_Hide="true">
                <CooldownTimeDelta m_CooldownTime="$attack_quick_reaction_cooldown" m_CustomName="Quick" m_CooldownOnAbort="true">
                    <SequenceMem>
                        <Cnd_IsBBValueEqual_string m_Key="#morale_state" m_Value="aggressive"/>
                        <Cnd_IsCombatTargetMeleeReachable/>
                        <Cnd_InTargetHorzAngle m_Target="#target" m_Angle="45"/>
                        <Cnd_IsTargetInAir m_Target="#target" m_Invert="true"/>
                        <Cnd_IsCombatTargetInRange m_Radius="$attack_quick_reaction_max_range" m_Angle="$attack_quick_max_angle"/>
                        <CombatSlot m_Name="$attack_push_token" m_Limit="$attack_push_limit" m_MinDelay="$attack_push_min_delay" m_Cost="#attack_cost" m_CheckIfUsing="true">
                            <ExternalTree m_UID="HUMAN_ATTACK_QUICK_BLIND" m_CustomName="Quick" m_Hide="true"/>
                        </CombatSlot>
                    </SequenceMem>
                </CooldownTimeDelta>
            </Optional>
        </SelectorMem>
    </CooldownUntil>
</BehaviorTree>
