<?xml version="1.0"?>
<BehaviorTree xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../../MetaData/schema_ai.xsd" m_ContextType="ai">
    <SequenceMem>
        <Cnd_CanStartTask m_StartPolicy="INTERRUPT"/>
        <Cnd_HasActiveWeapon m_WeaponType="TwoHandedMelee"/>
        <Selector>
            <Cnd_IsHoldRequired m_Invert="true"/>
            <Cnd_SelfInHoldRadius/>
        </Selector>
        <Selector>
            <Cnd_IsRestrictedAreaRequired m_Invert="true"/>
            <Cnd_SelfInRestrictedArea/>
        </Selector>
        <Cnd_HasPathToCombatTarget/>
        <Cnd_HasCombatTargetNoControl m_Invert="true"/>
        <Sequence>
            <Cnd_IsBBValueEqual_string m_Key="#role" m_Value="melee"/>
            <CooldownUntil m_TimePoint="#attack_cooldown" m_CooldownTime="$attack_cooldown" m_CooldownOnAbort="true">
                <SelectorMem>
                    <BlackboardSwitch m_Enabled="#enable_attack_push" m_CustomName="AttackPush" m_Hide="true">
                        <CooldownTimeDelta m_CooldownTime="$attack_push_cooldown" m_CustomName="AttackPush" m_CooldownOnAbort="true">
                            <SequenceMem>
                                <Cnd_IsCombatTargetMeleeReachable/>
                                <Selector>
                                    <Cnd_IsActivityModuleRunning_HitReaction/>
                                    <Cnd_IsCombatTargetInRadius m_Radius="2.5"/>
                                    <Selector>
                                        <Cnd_TargetIsDodging m_Target="#target"/>
                                        <Cnd_TargetIsBlocking m_Target="#target"/>
                                    </Selector>
                                </Selector>
                                <ExternalTree m_UID="HUMAN_ATTACK_PUSH" m_CustomName="Push" m_Hide="true"/>
                                <Succeeder>
                                    <BlackboardSwitch m_Enabled="#enable_attack_push_followup">
                                        <SelectorMem>
                                            <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="retreat"/>
                                            <ExternalTree m_UID="HUMAN_ATTACK_POWER_OVERHEAD_RECOVERY" m_CustomName="PowerOverheadRecovery" m_Hide="true"/>
                                        </SelectorMem>
                                    </BlackboardSwitch>
                                </Succeeder>
                            </SequenceMem>
                        </CooldownTimeDelta>
                    </BlackboardSwitch>
                    <CooldownTimeDelta m_CooldownTime="$attack_power_360_cooldown" m_CooldownOnAbort="true" m_CooldownBeforeFirstTick="false">
                        <SequenceMem>
                            <Cnd_IsCombatTargetMeleeReachable/>
                            <Selector>
                                <Optional m_Enabled="$enable_attack_power_360_coop">
                                    <CooldownTimeDelta m_CooldownTime="$attack_power_360_coop_cooldown">
                                        <Sequence>
                                            <Cnd_IsPlayer m_Target="#target"/>
                                            <Cnd_AreCoopPlayersInRadius m_Radius="$attack_power_360_max_range" m_MinCount="2"/>
                                        </Sequence>
                                    </CooldownTimeDelta>
                                </Optional>
                                <BlackboardSwitch m_Enabled="#enable_attack_power_360">
                                    <Sequence>
                                        <Cnd_IsCombatTargetInRange m_Radius="$attack_power_360_max_range" m_Angle="$attack_power_360_min_angle" m_InvertAngleCheck="true"/>
                                        <Cnd_AllyInLineOfFire m_Target="#target" m_CheckMelee="true" m_SpaceNeeded="1" m_Invert="true"/>
                                    </Sequence>
                                </BlackboardSwitch>
                            </Selector>
                            <ExternalTree m_UID="HUMAN_ATTACK_POWER_360" m_CustomName="Power360" m_Hide="true"/>
                        </SequenceMem>
                    </CooldownTimeDelta>
                    <BlackboardSwitch m_Enabled="#enable_attack_power_charge">
                        <CooldownTimeDelta m_CooldownTime="$attack_power_charge_cooldown" m_CooldownOnAbort="true" m_CooldownBeforeFirstTick="false">
                            <SequenceMem>
                                <Cnd_IsCombatTargetMeleeReachable/>
                                <Cnd_DistanceToTargetBetween m_Target="#target" m_MinDistance="$attack_power_charge_min_range" m_MaxDistance="$attack_power_charge_max_range"/>
                                <Cnd_IsCombatTargetInAngle m_Angle="$attack_power_charge_max_angle"/>
                                <Cnd_AllyInLineOfFire m_Target="#target" m_CheckMelee="true" m_SpaceNeeded="1" m_Invert="true"/>
                                <CombatSlot m_Name="$attack_two_handed_token" m_Limit="$attack_two_handed_limit" m_MinDelay="$attack_two_handed_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="#attack_token_release_on_damage" m_CheckIfUsing="true">
                                    <ExternalTree m_UID="HUMAN_ATTACK_POWER_CHARGE" m_CustomName="PowerCharge" m_Hide="true"/>
                                </CombatSlot>
                            </SequenceMem>
                        </CooldownTimeDelta>
                    </BlackboardSwitch>
                    <BlackboardSwitch m_Enabled="#enable_attack_power_swing_combo">
                        <CooldownTimeDelta m_CooldownTime="$attack_power_swing_combo_cooldown" m_CooldownOnAbort="true">
                            <SequenceMem>
                                <Cnd_IsCombatTargetInRadius m_Radius="$attack_attempt_range"/>
                                <CombatSlot m_Name="$attack_two_handed_token" m_Limit="$attack_two_handed_limit" m_MinDelay="$attack_two_handed_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="#attack_token_release_on_damage" m_CheckIfUsing="true">
                                    <Selector>
                                        <ExternalTree m_UID="HUMAN_ATTACK_POWER_SWING_COMBO" m_CustomName="PowerSwingCombo" m_Hide="true"/>
                                        <ExternalTree m_UID="HUMAN_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                                    </Selector>
                                </CombatSlot>
                            </SequenceMem>
                        </CooldownTimeDelta>
                    </BlackboardSwitch>
                    <BlackboardSwitch m_Enabled="#enable_attack_power_overhead">
                        <SequenceMem>
                            <Cnd_IsCombatTargetInRadius m_Radius="$attack_attempt_range"/>
                            <CombatSlot m_Name="$attack_two_handed_token" m_Limit="$attack_two_handed_limit" m_MinDelay="$attack_two_handed_min_delay" m_Cost="#attack_cost" m_ReleaseOnDamage="#attack_token_release_on_damage" m_CheckIfUsing="true">
                                <Selector>
                                    <ExternalTree m_UID="HUMAN_ATTACK_POWER_OVERHEAD_RECOVERY" m_CustomName="PowerOverheadRecovery" m_Hide="true"/>
                                    <ExternalTree m_UID="HUMAN_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                                </Selector>
                            </CombatSlot>
                        </SequenceMem>
                    </BlackboardSwitch>
                </SelectorMem>
            </CooldownUntil>
        </Sequence>
    </SequenceMem>
</BehaviorTree>
